name: imagenet_vit_mor_resume_stable
wandb: true
wandb_mode: online
wandb_entity: divijvignesh1223
wandb_project: vit-mor-experiments
wandb_run_name: resume_stable_training
output_dir: vit_mor_imagenet
wandb_run_id: 77HYRz9L
tensorboard: false
tensorboard_dir: null
resume_from_checkpoint: false
resume_step: null
model: vit_mor
dataset: imagenet1k
image_size: 224
patch_size: 16
num_labels: 1000
hidden_size: 768
num_hidden_layers: 7
num_attention_heads: 7
intermediate_size: 896
hidden_act: gelu
initializer_range: 0.02
layer_norm_eps: 1.0e-12
save_safetensors: true
checkpoint_format: safetensors
torch_load_weights_only: false
total_batch_size: 512
per_device_train_batch_size: 32
gradient_accumulation_steps: null
batch_size_rampup_steps: null
max_length: null
add_bos_token: false
global_shuffling: false
local_shuffling: false
tokenizer: null
model_name_or_path: vit-mor-custom
model_config: null
attn_implementation: flash_attention_2
use_pretrained_weights: false
recursive:
  enable: true
  base_depth: null
  num_recursion: 3
  sharing: middle_cycle
  ln_share: true
  initialization: stepwise
kv_sharing:
  enable: false
relaxation:
  enable: false
mor:
  enable: true
  type: expert
  capacity: 0.6,0.3,0.1
  rand_router: false
  router_type: linear
  z_loss: true
  z_coeff: 0.001
  temp: 1.5
  expert:
    cap_warmup_step: 0
    router_func: sigmoid
    alpha: 0.08
    sampling: aux_loss
    include_first: true
    coeff: 0.005
    gating: weighted
lr_scheduler_type: warmup_stable_decay
lr_scheduler_kwargs:
  num_decay_steps: 10000
  decay_type: cosine
learning_rate: 3.0e-05
adam_beta1: 0.9
adam_beta2: 0.999
weight_decay: 0.005
precision: bf16
max_grad_norm: 1.0
num_train_steps: 150000
stop_steps: 150000
num_warmup_steps: 1000
save_steps: 1000
logging_steps: 25
save_interval: 0.1
fixed_save_steps: null
save_total_limit: 10
dataloader_num_workers: 4
gradient_checkpointing: false
deepspeed: ds_configs/stage2.config
evaluation:
  enable: false
resume_training:
  reset_lr_scheduler: false
  reset_optimizer: false
  reduce_on_plateau: true
  patience: 5000
  factor: 0.5
  min_lr: 1.0e-06
router_stabilization:
  enable: true
  gradient_penalty: 0.01
  entropy_regularization: 0.001
  load_balance_loss: 0.01
